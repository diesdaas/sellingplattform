generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Model - Isolated in Auth Service
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String
  role          String   @default("customer") // "customer" | "artist" | "admin"
  isVerified    Boolean  @default(false)
  emailVerifiedAt DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  sessions      Session[]
  tokens        Token[]

  @@map("users")
}

// Session Model - Redis-backed sessions
model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  device    String?  // "web", "mobile", etc.
  userAgent String?
  ipAddress String?
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

// Token Model - For email verification and password reset
model Token {
  id        String   @id @default(cuid())
  userId    String
  type      String   // "email_verification" | "password_reset"
  token     String   @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("tokens")
}
